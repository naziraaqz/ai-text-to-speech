<script>
  let meSpeakReady = false;

  meSpeak.loadConfig("https://cdn.jsdelivr.net/npm/mespeak@1.0.5/mespeak_config.json", function() {
    meSpeak.loadVoice("https://cdn.jsdelivr.net/npm/mespeak@1.0.5/voices/en/en.json", function() {
      meSpeakReady = true;
      console.log("meSpeak siap digunakan.");
    });
  });

  function generateSpeech() {
    if (!meSpeakReady) {
      alert("Suara masih dimuat, silakan tunggu sebentar...");
      return;
    }

    const text = document.getElementById("text-input").value;
    if (text.trim() === "") {
      alert("Masukkan teks terlebih dahulu.");
      return;
    }

    const audioData = meSpeak.speak(text, { rawdata: "data-url" });

    const audioPlayer = document.getElementById("audio-player");
    audioPlayer.src = audioData;
    audioPlayer.style.display = "block";
    audioPlayer.play();

    const existingDownload = document.getElementById("download-link");
    if (existingDownload) existingDownload.remove();

    const downloadLink = document.createElement("a");
    downloadLink.href = audioData;
    downloadLink.download = "speech.wav";
    downloadLink.innerText = "Download Audio";
    downloadLink.id = "download-link";
    downloadLink.style.display = "block";
    downloadLink.style.marginTop = "10px";
    document.body.appendChild(downloadLink);
  }
</script>
